<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Flask EKS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b1220; --fg:#e6eefc; --muted:#9fb3d9; --accent:#69b3ff; }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:radial-gradient(1200px 800px at 20% -10%,#1b2845,transparent),
                 radial-gradient(900px 600px at 120% -20%,#12243e,transparent),
                 var(--bg);
      color:var(--fg);min-height:100vh;display:grid;place-items:center;padding:24px;
    }
    .card{width:min(720px,92vw);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
      border-radius:20px;padding:28px;box-shadow:0 10px 40px rgba(0,0,0,.35);backdrop-filter:blur(8px)}
    h1{margin:0 0 6px;letter-spacing:.4px}.sub{margin:0 0 18px;color:var(--muted)}
    .notice{margin:10px 0 20px;color:var(--muted);font-size:.98rem}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-top:10px}
    button{background:var(--accent);color:#071120;border:none;border-radius:12px;padding:10px 14px;
      font-weight:600;cursor:pointer;transition:transform .05s ease,filter .2s ease}
    button:hover{filter:brightness(1.05)}button:active{transform:translateY(1px)}
    .slider{appearance:none;width:220px;height:6px;border-radius:999px;background:rgba(255,255,255,.18);outline:none}
    .hint{margin-top:6px;font-size:.9rem;color:var(--muted)}.meta{margin-top:16px;color:var(--muted);font-size:.92rem}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="card">
    <h1>Flask on EKS</h1>
    <p class="sub">Music fades in after your first click or tap üéµ</p>

    <div class="meta">
      <div>Version: <b>{{ version }}</b></div>
      <div>{{ message }}</div>
      <div><small>Updated: {{ timestamp }}</small></div>
    </div>

    <!-- Use server-provided audio_url -->
    <audio id="bg-music" autoplay muted loop playsinline preload="auto" crossorigin="anonymous">
      <source id="audio-src" src="{{ audio_url }}" type="audio/mpeg" />
      Your browser does not support the audio element.
    </audio>

    <div class="controls">
      <button id="playPauseBtn" type="button">‚ñ∂ Play</button>
      <label class="sr-only" for="volume">Volume</label>
      <input id="volume" class="slider" type="range" min="0" max="100" value="0" />
      <span id="volVal" aria-hidden="true">0%</span>
    </div>

    <p class="hint notice">If your browser blocks sound, just click anywhere or press ‚ÄúPlay‚Äù.</p>
  </div>

  <script>
    (function () {
      const audio = document.getElementById('bg-music');
      const btn = document.getElementById('playPauseBtn');
      const vol = document.getElementById('volume');
      const volVal = document.getElementById('volVal');

      const TARGET_VOLUME = 0.60;
      const FADE_MS = 2500;

      audio.volume = 0.0;
      vol.value = 0;
      volVal.textContent = '0%';

      function fadeTo(target = TARGET_VOLUME, ms = FADE_MS) {
        const start = audio.volume;
        const delta = target - start;
        const t0 = performance.now();
        function tick(t) {
          const p = Math.min(1, (t - t0) / ms);
          audio.volume = Math.min(1, Math.max(0, start + delta * p));
          vol.value = Math.round(audio.volume * 100);
          volVal.textContent = `${vol.value}%`;
          if (p < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      }

      async function engageAndPlay() {
        try {
          audio.muted = false;
          await audio.play();
          fadeTo(TARGET_VOLUME, FADE_MS);
          btn.textContent = '‚è∏ Pause';
        } catch (e) {
          console.log('Playback blocked:', e);
        } finally {
          document.removeEventListener('click', engageAndPlay);
          document.removeEventListener('keydown', engageAndPlay);
          document.removeEventListener('touchstart', engageAndPlay, {passive: true});
        }
      }

      document.addEventListener('click', engageAndPlay);
      document.addEventListener('keydown', engageAndPlay);
      document.addEventListener('touchstart', engageAndPlay, {passive: true});

      btn.addEventListener('click', async () => {
        if (audio.paused) {
          await engageAndPlay();
        } else {
          const v = audio.volume;
          fadeTo(0.0, 350);
          setTimeout(() => { audio.pause(); btn.textContent = '‚ñ∂ Play'; audio.volume = v; }, 380);
        }
      });

      vol.addEventListener('input', () => {
        const target = Math.max(0, Math.min(1, vol.value / 100));
        audio.muted = false;
        audio.volume = target;
        volVal.textContent = `${vol.value}%`;
        if (audio.paused && target > 0) {
          audio.play().then(() => { btn.textContent = '‚è∏ Pause'; }).catch(()=>{});
        }
      });
    })();
  </script>
</body>
</html>
